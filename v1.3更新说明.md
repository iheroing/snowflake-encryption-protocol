# 雪花密语 v1.3 更新说明

## 🎉 重大更新：真实加密系统

你的问题「这些按钮是什么意思？另外，如何实现解密与销毁问题？」已经完全解决！

---

## ✨ 新功能一览

### 1. 🔐 真实的 AES-256 加密

不再是演示性质的简单编码，现在使用**军事级 AES-256-GCM 加密**：

- ✅ Web Crypto API（浏览器原生加密）
- ✅ PBKDF2 密钥派生（100,000 次迭代）
- ✅ 随机盐和 IV（每次加密都不同）
- ✅ 认证加密（防篡改）

### 2. 🔑 密码保护功能

创建心语时可以选择是否加密：

- **无密码模式**：快速创建，适合不敏感的内容
- **密码保护模式**：输入密码加密，只有知道密码的人才能查看

**操作步骤**：
1. 输入心语
2. 点击「密码保护」按钮
3. 输入密码（至少 6 位）
4. 确认密码
5. 凝结心语

### 3. 🔍 画廊功能完善

**三个按钮的含义**（你问的问题）：

| 按钮 | 功能 | 说明 |
|------|------|------|
| 🔄 刷新 | 重新加载画廊 | 刷新显示最新的心语列表 |
| 🔍 搜索 | 搜索心语内容 | 输入关键词搜索（只能搜索明文） |
| ⬆️⬇️ 排序 | 切换排序方式 | 最新优先 ↔️ 最旧优先 |

**新增功能**：
- 🔒 加密的心语显示锁图标
- 🗑️ 每条心语可单独删除
- 🔐 点击加密心语时弹出密码输入框
- ✅ 密码正确才能查看内容
- ❌ 密码错误会提示重试

### 4. 🗑️ 安全销毁机制

**两种销毁方式**：

#### 方式一：60秒自动销毁（查看页面）
- 倒计时结束，雪花融化
- 页面关闭，内存清除
- 但画廊记录仍保留

#### 方式二：手动永久销毁（画廊）
- 点击心语卡片右上角的删除按钮
- 确认销毁
- 系统会：
  1. 在内存中多次覆写敏感数据
  2. 从本地存储永久删除
  3. **无法恢复**

---

## 🔧 技术改进

### 文件更新

1. **`utils/encryption.ts`** - 完全重写
   - 实现 AES-256-GCM 加密/解密
   - PBKDF2 密钥派生
   - 安全销毁函数

2. **`utils/storage.ts`** - 增强
   - 支持存储加密消息
   - 安全删除（覆写后删除）
   - 新增 `hasPassword` 字段

3. **`components/EncryptView.tsx`** - 新增密码输入
   - 密码保护开关
   - 密码输入框（带确认）
   - 密码强度验证

4. **`components/GalleryView.tsx`** - 功能完善
   - 搜索功能实现
   - 排序功能实现
   - 密码输入模态框
   - 删除按钮
   - 加密状态显示

5. **`App.tsx`** - 参数更新
   - 支持加密参数传递
   - 画廊查看功能

---

## 📊 数据结构

```typescript
interface SnowflakeRecord {
  id: string;                    // 唯一标识
  message: string;               // 明文消息（用于显示）
  encryptedMessage?: string;     // 加密后的消息（可选）
  hasPassword: boolean;          // 是否设置了密码
  timestamp: number;             // 创建时间戳
  essence: 'aurora' | 'stardust'; // 精华类型
}
```

---

## 🎯 使用场景

### 场景 1：日常心语（无密码）
适合：日记、随笔、不敏感的内容
- 快速创建
- 随时查看
- 60秒倒计时增加仪式感

### 场景 2：私密心语（有密码）
适合：秘密、情话、敏感信息
- 设置密码保护
- 只有知道密码的人能看
- 真正的端到端加密

### 场景 3：阅后即焚
适合：一次性消息、临时分享
- 创建后立即查看
- 60秒后自动销毁
- 不保存到画廊（手动删除）

---

## 🛡️ 安全性说明

### 加密强度
- **AES-256**：美国政府用于保护机密信息的标准
- **PBKDF2**：防止暴力破解（100,000 次迭代）
- **GCM 模式**：同时提供加密和认证

### 安全建议
1. ✅ 使用强密码（8位以上，包含字母数字符号）
2. ✅ 不要重复使用密码
3. ✅ 及时删除不需要的心语
4. ⚠️ 密码丢失无法恢复
5. ⚠️ 清除浏览器数据会丢失所有心语

---

## 🎨 界面优化

### 新增视觉元素
- 🔒 密码保护图标（锁）
- 🗑️ 删除按钮（垃圾桶）
- 🔍 搜索框（底部弹出）
- ⬆️⬇️ 排序指示器
- 🔐 密码输入模态框

### 交互改进
- 密码输入支持回车确认
- 删除前二次确认
- 搜索实时显示结果数量
- 排序一键切换

---

## 📝 部署说明

### 本地测试
```bash
npm run dev
```

### 构建生产版本
```bash
npm run build
```

### 部署到 Vercel
```bash
git add .
git commit -m "feat: 实现真实加密系统 v1.3"
git push origin main
```

Vercel 会自动部署最新版本。

---

## 🐛 已知限制

1. **本地存储**：数据保存在浏览器，不支持跨设备同步
2. **密码恢复**：密码丢失无法恢复（这是设计特性，不是 bug）
3. **搜索限制**：只能搜索明文心语，加密的需要先解密
4. **浏览器兼容**：需要支持 Web Crypto API（现代浏览器都支持）

---

## 🚀 下一步计划

可能的未来功能（如果需要）：

- [ ] 导出/导入功能（备份心语）
- [ ] 分享加密心语（生成链接）
- [ ] 自定义倒计时时长
- [ ] 主题切换（深色/浅色）
- [ ] 多语言支持
- [ ] 云端同步（需要后端）

---

## 💬 反馈

如果有任何问题或建议，随时告诉我！

**现在你可以：**
1. 创建真正加密的心语 🔐
2. 使用画廊的搜索和排序功能 🔍
3. 安全地销毁不需要的心语 🗑️

---

**世上没有两片相同的雪花，也没有两个相同的秘密。** ❄️

*雪花密语 v1.3 - 2026.01.18*
