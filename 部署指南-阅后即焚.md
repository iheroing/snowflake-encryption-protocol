# é›ªèŠ±å¯†è¯­ - é˜…åå³ç„šåŠŸèƒ½éƒ¨ç½²æŒ‡å—

## ğŸ¯ æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ éƒ¨ç½²å¸¦æœ‰é˜…åå³ç„šåŠŸèƒ½çš„é›ªèŠ±å¯†è¯­åº”ç”¨ã€‚

---

## ğŸ“‹ å‰ç½®å‡†å¤‡

### 1. æ³¨å†Œ Upstash Redis

1. è®¿é—® [Upstash](https://upstash.com/)
2. æ³¨å†Œ/ç™»å½•è´¦å·
3. åˆ›å»ºæ–°çš„ Redis æ•°æ®åº“
   - é€‰æ‹©åŒºåŸŸï¼ˆæ¨èï¼šç¦»ç”¨æˆ·æœ€è¿‘çš„åŒºåŸŸï¼‰
   - é€‰æ‹©å…è´¹è®¡åˆ’ï¼ˆè¶³å¤Ÿä½¿ç”¨ï¼‰
4. è·å–è¿æ¥ä¿¡æ¯ï¼š
   - `UPSTASH_REDIS_REST_URL`
   - `UPSTASH_REDIS_REST_TOKEN`

### 2. é…ç½®ç¯å¢ƒå˜é‡

#### æœ¬åœ°å¼€å‘
åˆ›å»º `.env.local` æ–‡ä»¶ï¼š
```env
UPSTASH_REDIS_REST_URL=https://xxx.upstash.io
UPSTASH_REDIS_REST_TOKEN=AXXXxxx
```

#### Vercel éƒ¨ç½²
åœ¨ Vercel Dashboard ä¸­é…ç½®ï¼š
1. è¿›å…¥é¡¹ç›®è®¾ç½®
2. æ‰¾åˆ° Environment Variables
3. æ·»åŠ ä»¥ä¸‹å˜é‡ï¼š
   - `UPSTASH_REDIS_REST_URL`
   - `UPSTASH_REDIS_REST_TOKEN`

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ–¹å¼ 1ï¼šè‡ªåŠ¨éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# 1. æäº¤ä»£ç 
git add .
git commit -m "feat: å®ç°é˜…åå³ç„šåŠŸèƒ½"
git push origin main

# 2. Vercel è‡ªåŠ¨éƒ¨ç½²
# è®¿é—® https://vercel.com/dashboard æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€

# 3. é…ç½®ç¯å¢ƒå˜é‡
# åœ¨ Vercel Dashboard ä¸­æ·»åŠ ç¯å¢ƒå˜é‡

# 4. é‡æ–°éƒ¨ç½²
# ç‚¹å‡» "Redeploy" æŒ‰é’®
```

### æ–¹å¼ 2ï¼šæ‰‹åŠ¨éƒ¨ç½²

```bash
# 1. å®‰è£… Vercel CLI
npm install -g vercel

# 2. ç™»å½•
vercel login

# 3. éƒ¨ç½²
vercel --prod

# 4. é…ç½®ç¯å¢ƒå˜é‡
vercel env add UPSTASH_REDIS_REST_URL
vercel env add UPSTASH_REDIS_REST_TOKEN

# 5. é‡æ–°éƒ¨ç½²
vercel --prod
```

---

## ğŸ§ª æµ‹è¯•

### 1. æµ‹è¯• API

#### åˆ›å»ºé›ªèŠ±
```bash
curl -X POST https://your-app.vercel.app/api/snowflake/create \
  -H "Content-Type: application/json" \
  -d '{
    "text": "æµ‹è¯•æ¶ˆæ¯",
    "ttl": 60,
    "essence": "aurora"
  }'
```

é¢„æœŸå“åº”ï¼š
```json
{
  "id": "abc123xyz",
  "qrCode": "data:image/png;base64,...",
  "expiresAt": 1234567890000,
  "decodeUrl": "https://your-app.vercel.app/decode/abc123xyz"
}
```

#### è§£ç é›ªèŠ±
```bash
curl https://your-app.vercel.app/api/snowflake/decode/abc123xyz
```

é¢„æœŸå“åº”ï¼š
```json
{
  "text": "æµ‹è¯•æ¶ˆæ¯",
  "essence": "aurora",
  "expiresIn": 45,
  "createdAt": 1234567890000
}
```

#### æµ‹è¯•è¿‡æœŸ
ç­‰å¾… 60 ç§’åå†æ¬¡è¯·æ±‚ï¼š
```bash
curl https://your-app.vercel.app/api/snowflake/decode/abc123xyz
```

é¢„æœŸå“åº”ï¼š
```json
{
  "error": "expired",
  "message": "é›ªèŠ±å·²èåŒ–ï¼Œæ— æ³•è§£å¯†"
}
```

### 2. æµ‹è¯•å‰ç«¯

1. è®¿é—®åº”ç”¨é¦–é¡µ
2. ç‚¹å‡»"å‡ç»“å¿ƒè¯­"
3. è¾“å…¥æ–‡å­—ï¼Œé€‰æ‹©æ—¶é—´
4. ç‚¹å‡»"å‡ç»“å¿ƒè¯­"
5. æŸ¥çœ‹é›ªèŠ±å’Œå€’è®¡æ—¶
6. ä¸‹è½½å›¾ç‰‡
7. ç­‰å¾…æ—¶é—´åˆ°æœŸ
8. å°è¯•æ‰«æï¼ˆåº”è¯¥å¤±è´¥ï¼‰

---

## ğŸ“Š ç›‘æ§

### Upstash Dashboard

1. è®¿é—® Upstash Dashboard
2. æŸ¥çœ‹ Redis ä½¿ç”¨æƒ…å†µï¼š
   - å­˜å‚¨çš„é”®æ•°é‡
   - å†…å­˜ä½¿ç”¨
   - è¯·æ±‚æ¬¡æ•°

### Vercel Analytics

1. è®¿é—® Vercel Dashboard
2. æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€
3. æŸ¥çœ‹å‡½æ•°è°ƒç”¨æ¬¡æ•°
4. æŸ¥çœ‹é”™è¯¯æ—¥å¿—

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šAPI è¿”å› 500 é”™è¯¯

**å¯èƒ½åŸå› **ï¼š
- ç¯å¢ƒå˜é‡æœªé…ç½®
- Redis è¿æ¥å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®
2. åœ¨ Vercel Dashboard æŸ¥çœ‹å‡½æ•°æ—¥å¿—
3. æµ‹è¯• Redis è¿æ¥

### é—®é¢˜ 2ï¼šäºŒç»´ç æ— æ³•æ‰«æ

**å¯èƒ½åŸå› **ï¼š
- URL ä¸æ­£ç¡®
- äºŒç»´ç ç”Ÿæˆå¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `VERCEL_URL` ç¯å¢ƒå˜é‡
2. æŸ¥çœ‹ API è¿”å›çš„ `decodeUrl`
3. æ‰‹åŠ¨è®¿é—® URL æµ‹è¯•

### é—®é¢˜ 3ï¼šè§£ç å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- é›ªèŠ±å·²è¿‡æœŸ
- ID ä¸æ­£ç¡®
- Redis æ•°æ®ä¸¢å¤±

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ˜¯å¦è¶…è¿‡æ—¶é—´é™åˆ¶
2. éªŒè¯ ID æ˜¯å¦æ­£ç¡®
3. æŸ¥çœ‹ Redis Dashboard

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. Redis é…ç½®

- ä½¿ç”¨æœ€è¿‘çš„åŒºåŸŸ
- å¯ç”¨ TLS
- é…ç½®åˆç†çš„ TTL

### 2. API ä¼˜åŒ–

- æ·»åŠ è¯·æ±‚é™æµ
- ç¼“å­˜äºŒç»´ç ç”Ÿæˆ
- å‹ç¼©å“åº”æ•°æ®

### 3. å‰ç«¯ä¼˜åŒ–

- æ‡’åŠ è½½æ‰«æç»„ä»¶
- ç¼“å­˜é›ªèŠ±å›¾ç‰‡
- ä¼˜åŒ–å›¾ç‰‡å¤§å°

---

## ğŸ”’ å®‰å…¨å»ºè®®

### 1. API å®‰å…¨

```typescript
// æ·»åŠ è¯·æ±‚é™æµ
import rateLimit from 'express-rate-limit';

const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 åˆ†é’Ÿ
  max: 100 // æœ€å¤š 100 ä¸ªè¯·æ±‚
});
```

### 2. æ•°æ®éªŒè¯

```typescript
// éªŒè¯è¾“å…¥
if (text.length > 1000) {
  return res.status(400).json({ error: 'Text too long' });
}

if (ttl > 86400) {
  return res.status(400).json({ error: 'TTL too long' });
}
```

### 3. CORS é…ç½®

```typescript
// é™åˆ¶æ¥æº
res.setHeader('Access-Control-Allow-Origin', 'https://your-app.vercel.app');
```

---

## ğŸ“ ç¯å¢ƒå˜é‡æ¸…å•

### å¿…éœ€
- `UPSTASH_REDIS_REST_URL` - Upstash Redis URL
- `UPSTASH_REDIS_REST_TOKEN` - Upstash Redis Token

### å¯é€‰
- `VERCEL_URL` - Vercel è‡ªåŠ¨è®¾ç½®
- `NODE_ENV` - ç¯å¢ƒï¼ˆdevelopment/productionï¼‰

---

## ğŸ‰ éƒ¨ç½²å®Œæˆ

éƒ¨ç½²æˆåŠŸåï¼Œä½ çš„åº”ç”¨å°†å…·å¤‡ä»¥ä¸‹åŠŸèƒ½ï¼š

âœ… åˆ›å»ºé›ªèŠ±ï¼ˆç¼–ç æ–‡å­—ï¼‰
âœ… ç”ŸæˆäºŒç»´ç 
âœ… è‡ªå®šä¹‰æ—¶é—´é™åˆ¶
âœ… æ‰«æè§£ç 
âœ… é˜…åå³ç„š
âœ… çœŸæ­£çš„æ—¶é—´é™åˆ¶

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹ [Upstash æ–‡æ¡£](https://docs.upstash.com/)
2. æŸ¥çœ‹ [Vercel æ–‡æ¡£](https://vercel.com/docs)
3. æ£€æŸ¥ GitHub Issues
4. æŸ¥çœ‹åº”ç”¨æ—¥å¿—

---

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼** ğŸš€
