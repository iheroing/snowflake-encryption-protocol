# 雪花密语 - 加密功能说明

## 🔐 加密系统概述

雪花密语现在支持真实的端到端加密，使用业界标准的 **AES-256-GCM** 加密算法，确保你的心语真正安全。

---

## ✨ 核心功能

### 1. **密码保护（可选）**
创建雪花时，你可以选择是否启用密码保护：

- **无密码模式**：心语以明文保存在本地，任何人打开画廊都能看到
- **密码保护模式**：心语使用 AES-256 加密，只有输入正确密码才能解密查看

### 2. **加密技术细节**

#### 加密算法
- **算法**：AES-256-GCM（Galois/Counter Mode）
- **密钥派生**：PBKDF2（100,000 次迭代）
- **哈希函数**：SHA-256
- **密钥长度**：256 位

#### 安全特性
- ✅ 每次加密使用随机盐（Salt）和初始化向量（IV）
- ✅ 密码不会被保存，只在加密/解密时使用
- ✅ 使用 Web Crypto API（浏览器原生加密）
- ✅ 防止暴力破解（PBKDF2 高迭代次数）
- ✅ 认证加密（GCM 模式提供完整性验证）

---

## 🎯 使用方法

### 创建加密的心语

1. 点击「凝结心语」进入创建页面
2. 输入你的心语内容
3. 选择精华类型（极光之息 / 星尘之梦）
4. **点击「密码保护」按钮**
5. 输入密码（至少 6 位）
6. 确认密码
7. 点击「凝结心语」

### 查看加密的心语

1. 进入「心语画廊」
2. 带有 🔒 图标的心语是加密的
3. 点击加密的心语
4. 输入密码
5. 解密成功后即可查看完整内容

---

## 🗑️ 安全销毁

### 画廊中的销毁功能

每个心语卡片右上角都有删除按钮：
- 点击删除按钮
- 确认销毁操作
- 系统会：
  1. 在内存中多次覆写敏感数据
  2. 从本地存储中永久删除
  3. 无法恢复

### 60秒自动销毁

在解密查看页面：
- 倒计时 60 秒后，雪花自动融化
- 页面关闭，内存中的数据被清除
- 但画廊中的记录仍然保留（除非手动删除）

---

## 🔍 画廊功能说明

### 三个功能按钮

1. **🔄 刷新**：重新加载画廊中的所有心语
2. **🔍 搜索**：按内容搜索心语（只能搜索明文，加密的需要先解密）
3. **⬆️⬇️ 排序**：在「最新优先」和「最旧优先」之间切换

### 心语卡片标识

- **🔒 锁图标**：表示这条心语是加密的
- **👁️ 眼睛图标**：点击查看详情
- **🗑️ 删除图标**：永久销毁这条心语

---

## 🛡️ 安全建议

### ✅ 推荐做法

1. **使用强密码**：至少 8 位，包含字母、数字、符号
2. **不要重复使用密码**：每条重要心语使用不同密码
3. **及时销毁**：不需要的心语及时删除
4. **定期清理**：画廊最多保存 50 条记录，会自动清理旧记录

### ⚠️ 注意事项

1. **密码丢失无法恢复**：没有「忘记密码」功能，密码丢失 = 数据永久丢失
2. **本地存储**：所有数据保存在浏览器本地，清除浏览器数据会丢失所有心语
3. **不是云端同步**：换设备或浏览器无法访问之前的心语
4. **浏览器隐私模式**：隐私模式下创建的心语在关闭窗口后会丢失

---

## 🔬 技术实现

### 加密流程

```
明文 → UTF-8 编码 → AES-256-GCM 加密 → Base64 编码 → 存储
```

### 解密流程

```
存储 → Base64 解码 → AES-256-GCM 解密 → UTF-8 解码 → 明文
```

### 数据结构

```typescript
interface SnowflakeRecord {
  id: string;                    // 唯一标识
  message: string;               // 明文消息
  encryptedMessage?: string;     // 加密后的消息（可选）
  hasPassword: boolean;          // 是否加密
  timestamp: number;             // 创建时间
  essence: 'aurora' | 'stardust'; // 精华类型
}
```

---

## 💡 常见问题

### Q: 加密真的安全吗？
A: 使用的是军事级 AES-256 加密，配合 PBKDF2 密钥派生，在密码足够强的情况下，几乎不可能被破解。

### Q: 为什么不能找回密码？
A: 密码不会被保存，只在加密/解密时使用。这是为了最大化安全性，即使有人获取了你的浏览器数据，没有密码也无法解密。

### Q: 可以导出加密的心语吗？
A: 可以，但导出的是加密后的数据。你需要记住密码，并在其他地方使用相同的解密算法才能查看。

### Q: 删除后真的无法恢复吗？
A: 是的。删除时会在内存中多次覆写数据，然后从存储中删除。理论上无法恢复（除非有专业的数据恢复工具在删除前做了备份）。

---

## 🎨 设计理念

雪花密语的加密功能设计遵循以下原则：

1. **极致浪漫**：加密不应该破坏美感，密码保护是可选的
2. **极致安全**：使用真正的加密算法，不是简单的编码
3. **极致简洁**：复杂的技术，简单的操作
4. **极致易逝**：60秒倒计时 + 手动销毁，强调信息的珍贵

---

## 📝 更新日志

### v1.3 - 2026-01-18
- ✨ 新增 AES-256-GCM 加密支持
- ✨ 新增密码保护功能
- ✨ 新增安全销毁机制
- ✨ 新增画廊搜索功能
- ✨ 新增画廊排序功能
- 🔒 加密心语显示锁图标
- 🗑️ 每条心语可单独删除

---

**记住：世上没有两片相同的雪花，也没有两个相同的秘密。** ❄️
